---
date: 2019-11-11T00:00:00+00:00
title: Deploying This Static Website
description: How I deploy this static website generated by [Hugo](https://github.com/gohugoio/hugo) to an AWS S3 bucket and use CloudFront to serve it.
tags:
  - Continuous Deployment
  - AWS
weight: -210
---
# TODO

This is just a WIP blog post. I still need to figure out how to restrict access to my S3 bucket to only Cloudfront. I think I got it right, but as a result I have made manual changes to my bucket policy and to my Cloudfront config to get this to work for now.

I'm posting this now just to test my deployment pipeline creating a new page for me. I know that CLoudfront caches my index page so I'm just curious to see the results in action as changes to my website get rolled out.

# Preamble

If you read many tech blogs, you'll probably have seen the CSS of my website before. It is the [minimo](https://themes.gohugo.io/minimo/) theme for Hugo and it seems to be somewhat popular. I used to deploy this site to an EC2 instance and put Nginx infront of it, but I figured that it is probably a lot easier to manage a static website using a cloud provider's [CDN](https://en.wikipedia.org/wiki/Content_delivery_network) than to manage my own virtual machine. It means that I get to deploy my website with better performance, and I also don't have to log into my instance and run `yum update` every time a scary looking CVE comes out.

# Deployment instructions

The Cloudformation template that runs this site is (mostly) automated ***FIGURE OUT BUCKET POLICY*** and you can find it on the [repository](https://github.com/thaniri/personalwebsite/blob/master/template.yaml) for this website.

This is the process I got it down to so far:

1. Run an AWS CLI Command to deploy the stack: `aws cloudformation create-stack --stack-name thaniriS3wesbite --template-body file://template.yaml --region us-east-1 --parameters ParameterKey=DomainName,ParameterValue=thaniri.com ParameterKey=ValidationDomain,ParameterValue=thaniri.com`
2. Wait for the Cloudformation stack to get stuck on creating the Amazon Certificate Management resource. Cloudformation will provide a message to create a CNAME record in the domain that the website is going to be deployed to. Once the CNAME is made manually, the stack will proceed deploying. This can probably be automated by using the AWS CLI to parse this prompt and create the DNS record, but I only have one such website and I will not spend the time to do that.
3. Manually modify the Cloudfront distribution origin domain name to be the S3 bucket website `www.thaniri.com.s3-website-us-east-1.amazonaws.com`. ***So far I haven't figured out how to get the bucket policies right.***
4. Make a merge to my repository to get travis-ci to copy over the generated HTML files to the S3 bucket.


While the process has been simplified, the waiting for the CNAME record creation and as well as the Cloudfront resource creation does end up taking several minutes.

